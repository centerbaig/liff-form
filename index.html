async function init() {
  const whoEl = document.getElementById("who");
  const uidEl = document.getElementById("uid");

  try {
    whoEl.textContent = "กำลังเริ่ม LIFF...";

    await liff.init({ liffId: LIFF_ID });

    // ✅ ถ้าเปิดจากคอม/บราวเซอร์ปกติ จะไม่ใช่ LIFF context
    if (!liff.isInClient()) {
      whoEl.innerHTML = `<span class="err">ลิงก์นี้ต้องเปิดใน LINE เท่านั้น (เปิดจากคอมจะไม่ดึงโปรไฟล์)</span>`;
      uidEl.textContent = "";
      return;
    }

    if (!liff.isLoggedIn()) {
      whoEl.textContent = "กำลังเข้าสู่ระบบ LINE...";
      liff.login();
      return;
    }

    profile = await liff.getProfile();
    whoEl.textContent = profile.displayName || "(ไม่มีชื่อ)";
    uidEl.textContent = profile.userId || "";

  } catch (e) {
    whoEl.innerHTML = `<span class="err">LIFF error: ${e.message || e}</span>`;
    uidEl.textContent = "";
    console.error(e);
  }
}
